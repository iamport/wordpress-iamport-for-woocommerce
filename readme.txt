=== Plugin Name ===
Contributors: iamport
Donate link: http://www.iamport.kr
Tags: 네이버페이, 카카오페이, 페이코, 이니시스, KCP, naverpay, naver, payco, kakao, kakaopay, kpay, inicis, 유플러스, lguplus, uplus, 나이스, 나이스페이, nice, nicepay, 제이티넷, 티페이, jtnet, tpay, 다날, danal, 모빌리언스, mobilians, 정기결제, subscription, 해외카드, visa, master, jcb, shopping, mall, iamport
Requires at least: 3.5
Tested up to: 5.5.1
Stable tag: 2.2.33
License: GPLv2 or later
License URI: http://www.gnu.org/licenses/gpl-2.0.html

우커머스용 결제 플러그인. 신용카드/실시간이체/가상계좌/휴대폰소액결제 가능. 국내 여러 PG사를 지원.

== Description ==
Github 링크 : https://github.com/iamport/wordpress-iamport-for-woocommerce

아임포트는 국내 PG서비스들을 표준화하고 있는 결제 서비스입니다. 아임포트 하나면 국내 여러 PG사들의 결제 기능을 표준화된 동일한 방식으로 사용할 수 있게 됩니다.
이 플러그인은 아임포트 서비스를 우커머스(woocommerce)환경에 맞게 적용한 결제 플러그인입니다.
신용카드 / 실시간계좌이체 / 가상계좌 / 휴대폰소액결제를 지원합니다. <br>
"네이버페이", "삼성페이", "PAYCO(페이코)", "카카오페이", "KG이니시스", "KCP", "LGU+", "나이스정보통신", "JTNet(tPay)", "KICC", "다날", "모빌리언스(휴대폰소액결제)"를 지원하고 있습니다.
우커머스 정기결제 플러그인도 지원하고 있습니다.

1.4.2 버전부터는 다국어 지원이 가능합니다. 언어별 번역 프로젝트에 참여를 부탁드립니다.

1.4.1 버전부터는 Woocommerce Subscription(우커머스 정기결제)기능과 JTNet을 통한 해외카드결제(VISA/MASTER/JCB)카드결제도 지원합니다. (전달되는 카드정보는 워드프레스 내에 저장되지 않고 폐기되며 암호화되어 전송되며 SSL통신을 적용합니다)

http://www.iamport.kr 에서 아임포트 서비스에 대한 보다 상세한 내용을 확인하실 수 있습니다.

데모 페이지 : http://demo.movingcart.kr

*   아임포트 관리자 페이지( https://admin.iamport.kr ) 에서 관리자 회원가입을 합니다.
*   아임포트 플러그인을 다운받아 워드프레스에 설치합니다.
*   아임포트 시스템설정 페이지에서 "가맹점 식별코드", "REST API키", "REST API secret"을 플러그인 설정에 저장합니다.


== Installation ==

아임포트 플러그인 설치, https://admin.iamport.kr 에서 관리자 회원가입, 시스템설정 정보저장이 필요합니다.


1. 다운받은 iamport.zip파일을 `/wp-content/plugins/` 디렉토리에 복사합니다.
2. unzip iamport.zip으로 압축 파일을 해제하면 iamport폴더가 생성됩니다.
3. 워드프레스 관리자페이지에서 'Plugins'메뉴를 통해 "아임포트" 플러그인을 활성화합니다.
4. https://admin.iamport.kr 에서 관리자 회원가입 후 시스템설정 페이지의 "가맹점 식별코드", "REST API키", "REST API secret"를 확인합니다.
5. 우커머스(woocommerce) 결제 설정페이지에서 해당 정보를 저장합니다.

== Frequently Asked Questions ==
= 서비스 소개 =
http://www.iamport.kr
= 관리자 페이지 =
https://admin.iamport.kr
= 페이스북 =
https://www.facebook.com/iamportservice

= 고객센터 =
1670-5176 / cs@iamport.kr

== Screenshots ==
1. 아임포트 관리자 로그인 후 "시스템 설정" 페이지에서 "가맹점 식별코드", "REST API키", "REST API secret" 정보를 확인합니다.
2. 우커머스(woocommerce) 결제 설정 페이지에서 "가맹점 식별코드", "REST API키", "REST API secret" 정보를 저장합니다.


== Changelog ==
= 2.2.32 =
* 카드결제 수단에 다우데이타(페이조아) 추가

= 2.2.32 =
* 네이버페이 결제형 이용완료일을 수정할 수 있게 설정에 추가

= 2.2.31 =
* 워드프레스 영문 설정에서 키인결제 선택 시, 영문 번역되지 않은 부분 수정

= 2.2.30 =
* 페이먼트월 결제수단 추가
* JS SDK 버전 선택 기능 추가
* 환불/반품 신청 후, 상태 바로 바뀌도록 수정

= 2.2.29 =
* 네이버페이 정기결제 추가

= 2.2.28 =
* 우커머스 구독 플러그인이 없는 사용자에게 발생하던 결제 에러 수정

= 2.2.27 =
* 정기결제 결제수단 변경시 장바구니가 비어 결제수단이 사라지던 버그 수정
* 결제수단 변경시에도 카카오페이 카테고리 검사 되도록 추가

= 2.2.26 =
* 빌링키 이관 가맹점 customer_uid 검색시 무조건 1개 반환하도록 get_user_meta의 signle 속성 true로 지정
* 네이버페이 직접 호출 기능 추가

= 2.2.25 =
* 빌링키 이관 가맹점 대응 코드 작성
* 엑심베이 - 편의점 결제 일본어 표기 수정

= 2.2.24 =
* 카카오페이 / 알리페이 / 페이코 직접 호출 기능 추가
* 엑심베이 - 편의점 결제 다국어 지원

= 2.2.23 =
* 카카오페이 정기결제 2중반목 문제 수정

= 2.2.22 =
* 카카오페이 정기결제 이슈 수정

= 2.2.21 =
* 카카오페이 카테고리별 설정 기본값 버그 수정

= 2.2.20 =
* 2.2.19 변경사항에서 PHP5.4 미만을 지원하지 않는 문법이 추가되어 지원하도록 수정

= 2.2.19 =
* 아임포트(카카오페이) payment의 구매버튼을 노출을 카테고리로 제한하는 처리 추가

= 2.2.18 =
* 플러그인 활성화 시 격발되는 에러 나오지 않도록 개선

= 2.2.17 =
* v2 restAPI 라우터 추가

= 2.2.16 =
* 엑심베이 일본 편의점 결제 연동

= 2.2.15 =
* 3rd-party plugin 들이 $order->get_checkout_order_received_url() 보다 $gateway->get_return_url() 이 호출될 것으로 가정하고 filter hook 을 적용하는 경향이 있어서 변경

= 2.2.14 =
* 네이버페이(주문형) 옵션상품 구성할 때 Base Price : 0원 + Option Price 로 최종 가격 조율하는 경우 버튼 비활성화되는 오류 수정
* 네이버페이(주문형) 버튼 렌더링이 N개 되면 N개 모두 기능 활성화

= 2.2.13 =
* 사용자 선택 PG설정값 multi line 파싱 오류 수정(시스템별로 line feed 가 달라짐)
* PG사를 통한 PAYCO허브형 기능 지원

= 2.2.12 =
* 네이버페이 XML 정보 전달시 강제로 https->http 로 전환하는 로직 제거 (사이트의 SSL인증서상 오류가 없으면 이미지 URL은 https 를 네이버에서 지원함. http->https로 302 리디렉션 발생하면 오히려 이 부분은 네이버에서 문제가 됨)

= 2.2.11 =
* 네이버페이 설정 관련, get_terms()가 WP_Error 를 리턴할 수 있는 가능성 고려하여 방어코딩 ( IamportHelper를 이용한 코드 정리 ) : 코스모스팜 회원계정 삭제 기능시 오류 발생(Fatal Error)

= 2.2.10 =
* 우커머스 주문목록 리스트에 구매자 전화번호 컬럼 추가

= 2.2.9 =
* 가상계좌 발급 시 입금할 가상계좌 예금주명 정보 수집 및 어드민 표시 (예외. 나이스페이먼츠와 같이 예금주 정보를 제공하지 않는 PG사의 경우 표시되지 않음)

= 2.2.8 =
* 2.2.7 업데이트 영향으로 KEY-IN결제 카드정보 입력필드 안나오는 버그 수정

= 2.2.7 =
* 결제승인 주문건에 대해 배송준비중(처리중)상태 대신 가맹점에서 정의한 커스텀한 상태값으로 변경하는 기능 추가(배송준비중과 동일하게 고객 직접 환불 가능)
* Eximbay 세부 결제수단 추가(기존 : 신용카드만 가능 => 변경 : 신용카드/유니온페이/알리페이/위챗페이 선택 가능)

= 2.2.6 =
* 결제환불 시 면세공급가액 함께 입력해 환불요청할 수 있는 기능 추가(복합과세 설정 가맹점용)

= 2.2.5 =
* 교환/반품 시 리디렉션으로 처리될 수 밖에 없으므로 모달이 닫힐 때 history.back()시켜야 다음 링크이동시 영향을 받지 않음

= 2.2.4 =
* 정기결제 진행 시 Default 구매자명 처리 로직 개선
* 네이버페이(주문형) 옵션상품결제 시, TM Extra Option(Price Override)기능 추가

= 2.2.3 =
* 정기결제 건 카카오페이 결제수단도 Change Payment 지원

= 2.2.2 =
* 네이버페이(주문형) 옵션상품결제 시, TM Extra Option(옵션별 변동가격 포함) 플러그인 지원

= 2.2.1 =
* woocommerce subscription 플러그인 때문에 네이버페이 배송비 설정옵션 숨겨지는 버그 해결(우선순위 조정)

= 2.2.0 =
* 네이버페이(주문형) 옵션상품결제 시, YITH Product Option Add-on(옵션별 변동가격 포함) / Extra Product Option 플러그인 지원
* 교환기능, 환불기능 개별설정할 수 있도록 분리

= 2.1.16 =
* 기존에 "상품 옵션 추가" 기능으로 옵션상품을 생성한 경우, variation id 만으로는 선택된 옵션 구분이 불가능하여 네이버페이-주문형 결제에 실패했었습니다. (상품정보 XML조회단계에서 생성실패) 이 부분을 보완하였습니다.

= 2.1.15 =
* javascript 에서 parseInt 처리하는 바람에 Paypal 결제금액이 제대로 처리되지 않는 버그 수정

= 2.1.14 =
* 신용카드 결제, 최대 할부 개월 수 제한할 때 일시불만 선택가능하도록 제한하는 옵션 추가

= 2.1.13 =
* 네이버페이 결제가능여부 체크를 위한 우커머스 장바구니 버튼 활성상태 체크로직 보완(disabled button 을 검색할 때, attached form 내에서만 검색하도록)

= 2.1.12 =
* 3rd party 플러그인들이 모두 로딩된 시점임에도 불구하고, WC_Order_Item_Product::get_product() 가 boolean 을 반환하는 예상치 못한 상황이 있어 회피방식으로 개발

= 2.1.11 =
* 거래건별로 웹훅 URL을 현재 워드프레스 사이트 URL로 고정 (아임포트 관리자페이지 내 웹훅 설정 안해도됨)
* 다날-가상계좌 예금주에 회사상호가 들어가길 권장하고 있어서 필드 추가

= 2.1.10 =
* 상품페이지 내에서 네이버페이 결제 시, YITH Product Add On 에 의해 추가되는 메타데이터 우커머스 주문내역에 남겨지도록 수정

= 2.1.9 =
* Eximbay 로 KRW 결제가 가능하도록 허용(Eximbay 에서 KRW결제가 가능해짐)

= 2.1.8 =
* Chrome 80 버전 업데이트를 대비한, 네이버페이(결제형) 레이어방식 적용해제(팝업방식)
* 기타 마이너한 소스코드 정리

= 2.1.7 =
* 아임포트 각 결제수단 내, 구매자가 직접 PG사 설정을 선택할 수 있는 기능 제공(예시 : 신용카드 내 국내결제/해외결제 등 구매자가 직접 선택이 필요한 경우)

= 2.1.6 =
* 결제수단정보가 DB에 제대로 반영될 수 있도록 WC_Order::save()를 명시적으로 호출

= 2.1.5 =
* 아임포트를 통한 Paypal 결제 지원
* 네이버페이(주문형) 결제정보 동기화를 위해 Webhook 주소 자동 지정(아임포트 관리자 페이지 Webhook 주소 설정할 필요없도록)

= 2.1.4 =
* 결제창방식 정기결제 시, Signup Fee == 0 && Free Trial일 때 정상건임에도 PHP오류로 실패처리되던 버그 수정
* 결제창방식 정기결제 최초 등록 실패 시, 재시도할 수 있도록 리디렉션

= 2.1.3 =
* 결제창방식의 정기결제 건에 대해, Webhook 호출 시 WC_Gateway_Iamport_Subscription_Ex::check_payment_response() 를 탈 수 있도록 경로 수정
* 우커머스 > 설정 > 아임포트 내 웹훅 URL 직접 설정하는 기능 삭제

= 2.1.2 =
* 아임포트 관련 Gateway로 처리된 주문이 아니면 고객환불요청에 대해 API 요청시도하지 않도록
* get_terms() 의 응답은 항상 array가 아닐 수 있으므로 대응
* 계좌이체 수단에 페이플 PG사 추가
* 네이버페이 배송비 계산 시, 우커머스 계산 방식 적용 (TODO : 카트 동기화 이슈가 있어서 추후 global 설정으로 변경해야 할 듯)

= 2.1.1 =
* 네이버페이 Weight Based Shipping 플러그인 배송비 지원

= 2.1.0 =
* 네이버페이 상품 항목별로 상세정보 동기화 및 환불기능 지원

= 2.0.101 =
* 카카오페이 정기결제 multiple subscription 허용(2.0.86 업데이트 내용 카카오페이 정기결제에도 확장)

= 2.0.100 =
* 우커머스 Formatted Shipping Address를 아임포트에 전달할 때 줄바꿈(Line Feed) 제거하지 않는 옵션 추가

= 2.0.99 =
* 네이버페이 상세조회 API 호출 실패에 대한 로그 기록
* 카드입력폼 Label / Placeholder 명칭 수정

= 2.0.98 =
* 네이버페이 결제건에 대해서만 WooShipping 연동(2.0.96패치 보완)
* URL parsing 라이브러리 global 변수명 변경

= 2.0.97 =
* 실시간계좌이체 / 가상계좌에 KG모빌리언스 PG사 선택가능하도록 옵션 추가

= 2.0.96 =
* 네이버페이 주문 건에 대해 WooShipping 플러그인에 의해 송장정보가 등록되면 네이버페이 API를 통해 배송정보 연동

= 2.0.95 =
* 모빌리언스 휴대폰 정기결제 추가

= 2.0.94 =
* 신용카드 결제시 최대 할부 개월수 선택 제한되도록 설정기능 추가

= 2.0.93 =
* 정기결제 / 키인결제 주문명을 상품명에 기반하여 생성되도록 수정

= 2.0.92 =
* 네이버페이 배송방법을 지정할 배송구역 설정옵션 추가
* 정기결제 매출전표 나오지 않는 부분 기능 추가
* mypage에서 결제수단 변경하였을 때 gateway 가 반영될 수 있도록 수정

= 2.0.91 =
* 네이버페이 상품정보 XML 조회 endpoint는 Really Simple SSL 이 리디렉션 하지 않도록 설정(네이버페이의 경우 https 요청을 처리하지 못한다)

= 2.0.90 =
* javascript argument 누락으로 정기결제 카드변경 안되는 버그 수정

= 2.0.89 =
* 카드검증을 위해 checking amount 결제 시 복합과세 상점아이디일 수 있으므로 tax_free는 항상 0으로 지정

= 2.0.88 =
* 모빌리언스 신용카드 결제 지원

= 2.0.87 =
* 다날-신용카드 정기결제인 경우에, 카드등록 & 최초과금을 하나의 트랜잭션으로 처리(결제창에 정기결제 금액 표시되는 방식)

= 2.0.86 =
* multiple subscription 지원. (결제주기가 다른 정기결제 동시에 checkout 허용)

= 2.0.85 =
* KCP 에스크로 결제모드 시, 상점아이디가 입력돼있으면 동작하지 않는 버그 수정

= 2.0.84 =
* 가상계좌 입금대기중 상태가 아니면 가상계좌 입금정보 보여주지 않기
* (결제창방식)정기결제 주문명 보기좋게 변경

= 2.0.83 =
* KEY-IN 결제 가맹점 계약상황에 따라 카드번호 + 유효기간 또는 카드번호 + 유효기간 + 생년월일(사업자등록번호) 인증만으로 가능한 경우도 있어서, 필수 카드입력 UI 설정가능하도록 개선

= 2.0.82 =
* 정기결제 최초과금 / KEY-IN 결제시 5만원 이상인 경우 할부 기능 추가
* 네이버페이 배송비 부가세 계산 로직 추가
* 상품/서비스 제공기간 설정 및 결제창 연동

= 2.0.81 =
* 외부 플러그인에 의해 WC_Order가 생성되는 경우 pay_method 가 없어 gateway를 찾지 못하는 경우가 확인 됨. fallback 처리하여 gateway를 찾을 수 있도록 대응

= 2.0.80 =
* 네이버페이 구매평 동기화 시 일부 테마에서 구매평 수량이 보이지 않는 문제 수정(comment_type : review 지정)
* 네이버페이 옵션명 최대 20자 제한

= 2.0.79 =
* BACS결제인 경우 Thankyou 페이지에서 $order가 null로 전송되는 경우가 확인 됨. 가상계좌 필터에서 오류발생하지 않도록 수정

= 2.0.78 =
* 자체적으로 구현한 find_gateway 함수에 대한 의존성 탈피(wc_get_payment_gateway_by_order 로 모두 대응가능함)

= 2.0.77 =
* 결제창 방식의 정기결제(KG이니시스, KCP, JTNet, 다날 등)에서 최초 결제금액이 0원인 경우 주문명을 최초과금 -> 카드등록으로 변경

= 2.0.76 =
* WoocommerceMembership 플러그인을 통한 상품 할인금액 적용 시 네이버페이 연동(merchantCustomCode1)

= 2.0.75 =
* 주문상태가 처리중일 때, key / secret 이 post meta정보로 존재하지 않더라도 환불허용해줌
* 아임포트가 커스텀 추가한 주문상태(ex. 가상계좌 입금대기 중 / 교환요청 / 반품요청)에 대해서 라벨명 변경 가능하도록 설정
* notice_url 파라메터 연동 (우커머스 사이트마다 Notification URL직접 지정 가능)
* 카드 유효기간 포맷변경에 유연하게 대응

= 2.0.74 =
* 알리페이 결제수단 추가

= 2.0.73 =
* 스마일페이 간편결제 추가
* 네이버페이 활성/비활성 설정 적용되도록 수정

= 2.0.72 =
* 2018-11-15에 네이버페이 구매평 점수체계가 변경 된 것에 맞춰서 수정

= 2.0.71 =
* 네이버페이(결제형) 템플릿 요청시 order 인자가 없는 경우가 있어서 필터링

= 2.0.70 =
* 2.0.69 버전 업데이트 시 네이버 찜하기 기능에 대해서는 연동이 누락되어 보완

= 2.0.69 =
* 하나의 아임포트 계정에 여러 개의 네이버페이(주문형) 세팅된 경우 파트너 ID지정할 수 있는 기능 추가(한 사업자가 여러 쇼핑몰 운영 가능)

= 2.0.68 =
* 네이버페이(결제형) iOS에서 뒤로가기로 다시 진입하여도 결제가 진행되도록 unblock 처리

= 2.0.67 =
* 네이버페이(결제형) 결제실패 시 주문번호 등 정보가 출력되지 않도록 수정
* 네이버페이(결제형) iOS 뒤로가기 진입 시 화면 초기화 적용

= 2.0.66 =
* 네이버페이(결제형) 상품 카테고리 추가

= 2.0.65 =
* 네이버페이(결제형) 네이버페이 카테고리 지정을 위해 상품카테고리 기준으로 지정기능 추가
* 네이버페이(주문형) 구매평 기간 동기화 1개월 제한 버그 수정

= 2.0.64 =
* 임의 기간 지정하여 네이버페이 구매평 동기화하는 기능 추가

= 2.0.63 =
* 결제실패시 실패 상세 사유를 표시 (기존에는 결제에 실패했다는 동일한 메세지만 출력되고 상세 원인이 출력되지 않았음)

= 2.0.62 =
* PHP 5.5 미만 버전에서 IamportHelper.php 오류나는 부분 수정

= 2.0.61 =
* 네이버페이(결제형) 검수모드 추가(검수용 계정에만 결제수단 노출)
* 우커머스 설정페이지 multiselect 사이즈가 작아지는 문제 css 보정

= 2.0.60 =
* 도서공연추가공제비 적용을 위한 복수PG / 네이버페이에 상품카테고리 지정 조건 추가 (등록된 상품이 너무 많은 경우)

= 2.0.59 =
* 완료(Completed)된 주문에 대해 교환/환불 허용 기한 설정 기능 추가
* 가상계좌 주문, 가상계좌 입금정보 구매자에게 Email 발송하는 기능 추가

= 2.0.58 =
* "우커머스 > 설정 > 세금 및 세금 계산 활성화" 가 체크된 경우 상품별로 면세 / 과세 구분하여 tax_free 파라메터 연동
* JTNet 해외카드 결제 시 KRW이외에는 결제요청되지 않도록 오류처리 (JTNet 해외카드 결제는 KRW결제만 허용함)
* php 5.3이하 버전에서 syntax 오류나는 부분 코드 수정

= 2.0.57 =
* 네이버페이 구매평 동기화시 Timezone(시간대) 맞지 않는 버그 수정

= 2.0.56 =
* 네이버페이(결제형) 결제수단 추가
* 네이버페이(주문형) 배송지 전화번호 1, 2 추가

= 2.0.55 =
* 네이버페이 구매평 동기화 기능 추가
* 네이버페이 구매시 주문자 / 배송지정보 구분해서 저장

= 2.0.54 =
* 네이버페이 상품목록 조회때문에 SQL수행속도 저하 문제 해결

= 2.0.53 =
* 도서공연비 상품설정 기본값 수정

= 2.0.52 =
* 네이버페이 결제시 도서공연비 소득공제 대상 지정 기능 추가

= 2.0.51 =
* 가맹점의 워드프레스 서버상 문제로 API요청에 실패할 수도 있는데, 그렇다고 해서 failed로 주문상태를 변경하는 것은 과한 조치이어서 OrderNote에만 기록하는 것으로 변경 ( Notification 을 통해 백업루틴이 돌고 있으므로 한 번 실패하더라도 정상적으로 "처리중"상태로 변경이 될 확률이 높음 )

= 2.0.50 =
* PG설정 제한을 위한 상품목록 조회 시, 워드프레스 설정(읽기)의 페이지당 게시물 개수에 제한되는 현상 확인. 최대 500개까지 목록 가져올 수 있도록 수정

= 2.0.49 =
* 2.0.48 패치된 WC\_Order->get\_formatted\_shipping\_address() 함수 필터링 제거

= 2.0.48 =
* 결제수단별로 복수PG설정이 적용될 상품지정할 수 있도록 변경 (도서공연추가소득공제, 과세/비과세 별로 나뉘어서 결제가 되어야 하는 경우)
* WC\_Order->get\_formatted\_shipping\_address() 함수가 조건에 따라 주소에 이름 / 우편번호 / 회사 등 정보를 함께 출력하는 경우들이 있어서 제거하는 filter 추가

= 2.0.47 =
* 네이버페이 배송메모 order_comments 에도 반영 및 줄바꿈

= 2.0.46 =
* 네이버페이 배송메모 / 배송기한 정보 OrderNote에 반영

= 2.0.45 =
* 생성된 주문정보의 currency에 따라 결제창에 currency 적용

= 2.0.44 =
* 2.0.41 에서 부족한 부분 추가 수정

= 2.0.43 =
* 네이버페이 결제건 주문 생성단계부터 Gateway 지정

= 2.0.42 =
* 카카오페이 일반결제 / 정기결제 구분하여 주문명 생성

= 2.0.41 =
* 아임포트 Payment Gateway가 아닌 경우에는 woocommerce hook 에 반응하지 않도록 수정
* Helper class 누락 수정

= 2.0.40 =
* 신규 카카오페이 일반결제/정기결제 지원
* 우커머스 order-key 길이 22자 제한에 대응

= 2.0.39 =
* 신규 카카오페이 변경옵션 추가

= 2.0.38 =
* 2.0.37 수정사항 중 "부가세 적용 안되는 버그수정" 반영이 제대로 안되어 다시 패치

= 2.0.37 =
* 결제 시 부가세 적용안되는 버그 수정
* iamport_order_status_changed action hook 에 세 번째 인자로 $order 전달
* 아임포트 javascript SDK CDN 적용

= 2.0.36 =
* 신용카드 / 계좌이체 / 가상계좌 / 휴대폰소액결제 동일 PG사의 복수 MID설정 지원

= 2.0.35 =
* 가상계좌 입금지정일, "당일자정까지" 옵션 선택시 오동작하는 버그 수정

= 2.0.34 =
* PG사 선택옵션에 KICC(한국정보통신) 추가

= 2.0.33 =
* 네이버페이 주문의 경우 created_via 값이 checkout 이 아니어서 일정시간이 지나도 재고수량을 놓지 않는 문제가 있어 수정

= 2.0.32 =
* 우커머스 상품 옵션이 2단이상으로 구성된 경우, 장바구니에 담은 후에 주문했을 때 2차 이상 옵션정보가 유실되는 버그 수정
* JTNet 정기결제 최초 결제 및 빌링키 발급을 동시에 진행하여 결제창에 금액정보가 노출되도록 수정(fake payment)
* 나이스페이먼츠 모바일 신규버전 적용(누락된 부분이 있어서 추가 반영)

= 2.0.31 =
* 결제창 방식 정기결제에 KCP 지원 추가

= 2.0.30 =
* slug와 비교할 때 slug는 sanitize_title된 결과이므로, 비교대상도 sanitize_title 하도록 수정

= 2.0.29 =
* 네이버페이 결제정보 동기화과정에서 DB sync딜레이가 의심됨 (iamport\_pre\_order\_completed 훅 추가)
* iamport\_pre\_order\_completed 에서 네이버페이 배송정보 등 모두 처리

= 2.0.28 =
* 2.0.27 버그픽스 보완

= 2.0.27 =
* 결제수단 네이버로 인식되지 않는 문제 해결
* 네이버페이 배송비 정보 기록되도록 수정

= 2.0.26 =
* 네이버페이 상품옵션코드가 한글인 경우 urlencode되어있어서 수정

= 2.0.25 =
* PHP warning 제거

= 2.0.24 =
* 처음 2.x 버전 업데이트하는 경우 네이버페이 설정 warning 나올 수 있어서 수정

= 2.0.23 =
* 특정 카테고리 상품 네이버페이 비활성상태로 설정가능하도록 추가
* Eximbay 지원 추가

= 2.0.22 =
* 정기배송상품은 네이버페이 결제 안되도록 수정
* 나이스페이-정기결제 결제수단 변경기능 추가(금액 추가결제 없음)
* 나이스페이-정기결제 카드사 정보, 카드정보 등록시각 표시

= 2.0.21 =
* PC결제에서도 삼성페이 결제 가능하도록 수정

= 2.0.20 =
* 장바구니 페이지 재진입 후 네이버페이 주문 시 주문정보 동기화 오류 버그 수정

= 2.0.19 =
* "바로구매(Quick Buy)" 플러그인과 충돌로, 네이버 구매버튼 중복으로 생기는 문제 수정

= 2.0.18 =
* 찜상품 URL이 이미 URI encoding되어 DB에 저장된 경우가 있어서 대비
* theme에서 class속성 제거를 하여 장바구니 페이지인지 인식하지 못하는 문제 대비

= 2.0.17 =
* 네이버페이 주문내역 동기화 기능 제공
* 가상계좌 입금통지 / 네이버페이 주문동기화시 상세 로깅 추가

= 2.0.16 =
* 네이버페이에 전달되는 이미지 URL은 모두 http로 변경

= 2.0.15 =
* 네이버정책상 판매불가상품이 포함되면 구매버튼 비활성처리(가격 0원, 배송불가, 다운로드상품, 재고수량없음 등)
* simple, variable, grouped 타입의 상품 모두 대응할 수 있도록 수정
* 네이버페이 유입스크립트 URL전달 시 URL에서 www 부분 제거

= 2.0.14 =
* PHP버전 5.3이하에서 syntax error 수정

= 2.0.13 =
* 찜정보 URL에 한글이 포함된 경우 네이버에서 인식하지 못함(encodeURI)
* 찜하기 상품이지 URL은 작은 사이즈로 변경
* 네이버 유입경로 관련 cookie 설정

= 2.0.12 =
* optionManageCodes 조회시 해당되는 combination만 반환하도록 수정
* 상품옵션별 차등 가격 적용안되던 버그 수정
* 한글명이 들어갈 수 있는 xml 모두 CDATA섹션처리
* 불필요한 코드 삭제 및 warning 메세지 제거

= 2.0.11 =
* 네이버페이 유입경로 스크립트 설정시 host만 지정해야함
* 네이버페이 버튼 스타일 지정 관련 버그 수정(장바구니 페이지)
* 상품정보XML에서 taxType누락된 버그 수정(TAX_FREE도 수정)
* 아임포트 우커머스 매뉴얼 링크 추가
* 아임포트 다른 결제수단은 사용하되 네이버페이 버튼만 사용하지 않을 수 있도록 수정

= 2.0.10 =
* 네이버페이 권역별 배송비 일반도서산간 / 제주도 구분이 매뉴얼에 반대로 되어있어 수정

= 2.0.9 =
* 네이버페이 검수모드시 버튼생성 스크립트 구분(PC/mobile, 상용/테스트)
* 권역별 배송비 차등 기능 추가(API에 의한 지역별 배송비 차등은 추후 지원)

= 2.0.8 =
* 장바구니에 상품이 비어있으면 네이버페이 버튼 출력하지 않음
* 장바구니에 담긴 모든 상품 카테고리 비교해서 네이버페이 버튼 출력여부 결정
* 네이버 유입분석 스크립트 추가

= 2.0.7 =
* 네이버페이 검수모드 지원(네이버페이 버튼 숨김상태에서 URL파라메터를 입력하면 출력되는 방식)

= 2.0.6 =
* 네이버페이 text/xml 에서 application/xml 로 Content-Type수정
* 네이버페이 xml URL에 iamport 식별가능한 파라메터로 설정

= 2.0.5 =
* warning메세지 관련 마이너 버그픽스

= 2.0.4 =
* 네이버페이 찜하기 기능 구현
* 네이버페이 특정 상품 카테고리에만 네이버페이 버튼 출력할 수 있는 기능 추가
* KCP 에스크로 결제 지원
* 우커머스 테마에서 last\_name, first\_name 입력받지 않는 경우 워드프레스 계정의 사용자 정보로 대체

= 2.0.3 =
* 복수PG세팅으로 네이버페이 결제 설정된 경우 대비

= 2.0.2 =
* 테마에 따라 네이버페이 버튼 생성안되는 버그 수정
* 네이버페이 버튼 위치 지정 설정 추가
* 네이버페이 버튼 스타일 지정 설정 추가

= 2.0.1 =
* 스크립트 오류 수정
* 네이버페이 구매버튼 사용하지 않는 옵션 추가

= 2.0.0 =
* 우커머스 3.x 버전기준으로 작성된 플러그인입니다. 우커머스 2.x 버전과는 더이상 호환되지 않습니다. 테스트 서버에서 충분한 테스트 후 백업본을 만들어두신 상태에서 업데이트하시길 권장드립니다. ( 우커머스 3.2.1까지 테스트 완료되었습니다. )
* 네이버페이 결제가 추가되었습니다.
* 테마 커스터마이즈로 구매자 이름, 전화번호 등을 입력받지 않는 경우에도 결제가 진행되도록 임의 처리
* 기타 자잘한 오류 수정

= 1.7.6 =
* 해외카드 결제 Gateway, 환불 API누락되어있어 추가 구현

= 1.7.5 =
* 모바일에서 "결제창방식 정기결제"완료 후 백버튼으로 뒤로 이동하면, 주문 상태가 "실패함"으로 바뀌는 버그 수정
* "결제창방식 정기결제"는 장바구니에 정기결제 상품이 담겨져있지 않으면 결제수단에 표시되지 않도록 개선
* 결제 주문명 커스터마이즈할 수 있도록 filter 정의
* 구매자 환불 프로세스에 대한 설명 보완해서 혼선 방지

= 1.7.4 =
* pg\_tid 필드 메타정보에 추가

= 1.7.3 =
* action hook 추가 정의(매뉴얼화)
* 에러 로깅 보강

= 1.7.2 =
* 다날-휴대폰소액결제 정기결제 추가
* 결제창 방식의 정기결제 시 금액 0원일 필요가 없는 경우에는 상품 원래 가격 그대로 표시

= 1.7.1 =
* 정기결제(결제창방식) 복수PG로 세팅되는 경우가 많으므로 PG상점아이디 추가로 받아서 복수PG사용 가능하도록 설정

= 1.7.0 =
* JTNet, KG이니시스, 다날과 같이 PG사 결제창을 통한 정기결제 방식도 지원

= 1.6.23 =
* 플러그인 영문 번역파일 추가

= 1.6.22 =
* jQuery 버전 체크해서 iOS카카오페이 바로오픈하는 속성 추가

= 1.6.21 =
* 다른 플러그인에서 billing_phone(우커머스 기본 required field)를 required항목에서 제외하고 입력창을 제거하는 경우가 있음.(ex. BEOMPS) 이 경우 KG이니시스 등 일부 PG사에서 buyer_tel누락오류가 발생할 수 있어 dummy number추가

= 1.6.20 =
* 모빌리언스도 휴대폰 소액결제 가능하도록 플러그인 업데이트

= 1.6.19 =
* (1.6.16기능 보충)아임포트 관리자 페이지에서 부분취소를 하는 경우에도 그 기록이 모두 저장될 수 있도록 수정.(환불 가능한 잔액이 남아있을 때까지는 결제 상태를 "환불됨"으로 바꾸지 않음)

= 1.6.18 =
* #order\_review관련 handler등록 방식 변경. 1.6.13버전 패치보다 안정적인 방식으로 변경(체크아웃 페이지에서 id="order\_review" name="check" 2가지 속성을 모두 가진 테마가 종종 발견됨)

= 1.6.17 =
* 테마에 따라서 submit을 중단해도 다른 submit handler가 submit해버리는 경우가 발생됨. stopImmediatePropagation() 호출로 방지

= 1.6.16 =
* 아임포트 관리자 페이지에서 취소하기로 환불하는 경우에도 우커머스 주문상태 변경될 수 있도록 Notification 구현
* 복수PG설정된 경우 WC\_Gateway\_Iamport\_Vbank 가 호출되더라도 실제 해당 결제건의 gateway를 찾아서 정확하게 REST API key, secret을 적용할 수 있도록 수정
* 아임포트가 주문상태를 변경할 때 do_action 할 수 있도록 추가(iamport\_order\_status\_changed)

= 1.6.15 =
* woocommerce 2.6부터 WC\_Payment\_Gateway\_CC->form을 사용해야 함

= 1.6.14 =
* 정기결제에서 free trial로 최초 결제할 금액이 없는 경우 빌링키 등록과정에서 실제 결제까지 가능한 카드인지 체크할 수 있도록 테스트 결제기능 추가

= 1.6.13 =
* 정기결제에서 free trial로 최초 결제할 금액이 없는 경우 빌링키 등록이 안되는 버그 수정(빌링키 등록 과정에서 카드정보 유효성 체크)
* Payment Form상태에서 KEY-IN결제도 ajax방식으로 인터페이스 공통화
* ajax 응답에 dummy string이 앞뒤에 있어도 필터링하여 처리될 수 있도록 수정
* 테마에 따라 카드결제정보 중복으로 발송될 수 있는 경우에 대한 대비(#order_review)

= 1.6.12 =
* 결제설정관련 "아임포트" 탭으로 정리
* 워드프레스 언어 설정이 한글이 아닌 경우 PG영문창 띄울 수 있도록 language설정(PG사가 영어지원을 하는 경우에 한해 적용됨)
* Woocommerce에 부가세 별도 설정이 활성화된 경우 vat파라메터 지정(면세, 일부 면세 등 사용 가능)
* 환불/교환버튼 비활성화를 원할 경우 처리할 수 있도록 설정기능 추가

= 1.6.11 =
* 정기결제에서 automatic retry for failed payment기능 사용가능하도록 subscription\_date\_changes 추가

= 1.6.10 =
* 1.6.9버전에서 설치 직후 아무런 세팅값을 설정하지 않았을 때, 기본값이 비활성화이어야 하는데 활성화로 처리되는 버그 수정

= 1.6.9 =
* "처리중"(결제가 완료됨을 의미) 상태의 주문을 "완료됨"(상품발송이 완료됨을 의미) 상태로 자동 변경하는 옵션 추가(결제 즉시 서비스가 개시되어야하는 경우 활용)

= 1.6.8 =
* 1.6.5의 woocommerce status변경에 대한 동시성 제어 버그 발견되어 수정

= 1.6.7 =
* 1.6.3에서 수정된 결제수단정보 업데이트 추가 버그 발견되어 수정(Notification이 먼저 도착하는 경우 항상 가상계좌로 처리되어버림)

= 1.6.6 =
* KEY-IN결제의 경우 비회원도 결제 가능하도록
* woocommerce order_key생성 규칙 더욱 복잡하게(중복발생 안되도록)

= 1.6.5 =
* 판매자가 가상계좌 입금기한을 제한할 수 있도록 설정기능 추가
* woocommerce status변경에 대해 동시성 제어를 위해 lock 기능 추가

= 1.6.4 =
* 비인증결제 KEY-IN/빌링방식 모두 지원(Woocommerce-Subscription플러그인 없이도 KEY-IN은 사용 가능하도록)
* PAYCO결제수단 추가
* PROXY환경에서 curl통신가능하도록 수정
* 가상계좌 입금시 통지되는 관리자 이메일, 이메일 타입 지정가능

= 1.6.3 =
* timezone offset을 고려하여 시각 정보 출력하도록 수정
* 관리자 페이지내 주문정보에 가상계좌 발급정보 같이 출력
* Checkout페이지에서 결제 중단 후 마이페이지에서 재결제를 최초와 다른 결제수단으로 진행하였을 때 결제수단정보 업데이트

= 1.6.2 =
* Notification이 너무 일찍 도달하는 경우 check\_payment\_response()가 동시에 두 번 호출되는 경우가 생김. (mysql동시성 해결전까지 pay_method로 필터링)
* 우커머스 서브스크립션 라벨 변경

= 1.6.1 =
* 결제수단으로 삼성페이 추가(KG이니시스 계약 필요)

= 1.6.0 =
* 복수PG사용자들이 결제수단별로 원하는 PG사 설정이 가능하도록 pg_provider 설정 추가

= 1.5.13 =
* 다날 신용카드/계좌이체/가상계좌 지원(다날 가상계좌의 경우 사업자등록번호 필수)

= 1.5.12 =
* wc-api 파라메터 추가하는 방식 변경
* 기본 출력 메세지 변경

= 1.5.11 =
* description이 선언되지 않은 결제수단 설정 필드 PHP Notice 발생되지 않도록 수정

= 1.5.10 =
* 상품이 여러 개 주문될 때 주문명이 잘못 만들어지는 버그 수정
* 플러그인 정보 확인용 버전 출력

= 1.5.9 =
* 중복 redirect 등의 이유로 결제 프로세스 도중 check\_payment\_response()가 여러 번 호출되더라도 문제없도록 redirect기능 추가

= 1.5.8 =
* 우커머스 정기결제(woocommerce-subscription) 재결제 후 active상태로 전환되지 않는 버그 수정
* 우커머스 정기결제(woocommerce-subscription) 취소/환불기능 지원

= 1.5.7 =
* 워드프레스가 설치된 서버 환경에 따라 아임포트 서버와의 REST API통신에 실패하는 경우가 있어 curl 설치 및 SSL접속 테스트 기능 추가

= 1.5.6 =
* 중단되었던 결제를 나의결제 페이지에서 다시 재시도할 때 escrow파라메터 제대로 세팅되지 않는 버그 수정
* 가상계좌 입금통지 설정 안내 추가(아임포트 Notification URL설정)

= 1.5.5 =
* 결제완료여부 확인할 때 파라메터 조작하여 미결제내역을 결제완료로 바꾸려는 시도에 대해 방어하도록 로직 수정
* 아임포트 Notification URL호출되었을 때 application/json타입으로 전달 될 수도 있어 대응하도록 수정

= 1.5.4 =
* hotfix : sprintf함수 인자에 %s에서 s가 빠지는 바람에 소스코드 인코딩에 따라 한글이 깨져서 post가 안되는 버그 수정

= 1.5.3 =
* $\_REQUEST 변수 사용하지 않도록 수정($\_GET, $\_POST를 직접 사용하도록)
* 가상계좌 입금통보 처리 로직 버그 수정

= 1.5.2 =
* 사용 중인 jquery-confirm.js가 boostrap때문에 일부 테마와 충돌나는 경우가 발생. 기본 jquery modal사용으로 변경(bootstrap기반 외부 라이브러리 제거)
* language번역 함수에 포함되지 않은 텍스트 수정

= 1.5.0 =
* 상품발송이 완료된(주문상태가 완료-Completed) 주문건에 대해 구매자가 판매자에게 반품 또는 교환을 요청할 수 있는 기능 추가(jquery 1.8이상 버전이 필요해 wordpress 최소 버전 3.5로 수정)
* 반폼 또는 교환 요청 시 요청 사유를 직접 기입할 수 있도록 기능 제공
* 반품요청/교환요청 상태가 추가되어 판매자 우커머스 주문목록에서 조회 가능

= 1.4.3 =
* 우커머스 정기결제(서브스크립션)에서 jQuery Card formatting잘못되는 버그 수정

= 1.4.2 =
* 다국어 지원 (번역파일은 부재)

= 1.4.1 =
* JTNet을 통한 해외카드(VISA/MASTER/JCB) 결제기능 지원
* 정기결제 / 해외카드 결제시 전송되는 카드정보에 RSA암호화 적용

= 1.4.0 =
* 우커머스 정기결제(woocommerce-subscription) 플러그인 기능 제공
* 구매자가 my-page에서 결제한 내역 직접 취소가능(processing-처리중 상태일 때만 가능. 서비스 제공 후 취소를 막기 위해 completed-완료됨 상태일 때는 불가능)

= 1.3.12 =
* 구매자 성명에서 이름 / 성이 반대로 출력되는 버그 수정(강동훈님 제보)

= 1.3.11 =
* 관리자에게 발송되는 가상계좌 입금확인 통지 Email에서 HTML/PlainText타입선택 옵션 제거. woocommerce 2.4.10부터 제공되는 기능이라 하위호환성차원에서 제거

= 1.3.10 =
* woocommerce 2.2 / 2.3에서는 ajax response시 dummy text를 앞뒤로 보내줘서 json parsing을 고의적으로 방해함. 해당 dummy제거를 위해 ajax dataFilter설정

= 1.3.9 =
* KG이니시스의 KPay간편결제를 결제수단으로 추가할 수 있도록 gateway추가.
* 기존 KG이니시스 결제창 내에서 KPay를 선택해서 사용할 수도 있었으나 KPay를 구매자에게 명시적으로 노출하기 위한 용도로 사용(Mac에서는 KG이니시스에서 KPay를 지원하지 않음)

= 1.3.8 =
* 1.3.6버전에서 추가된 기능("대기중" 상태의 주문을 다시 지불하려고 할 때)에서 카카오페이의 경우 제대로 동작하지 않는 버그 수정
* process_payment()에서 redirect파라메터를 재결제페이지로 이동(iamport.woocommerce.js에서 submit event를 잡아내는데 실패하더라도 재결제가 가능하도록)

= 1.3.7 =
* 휴대폰소액결제 전문 PG사인 다날을 이용해 별도의 휴대폰소액결제 서비스를 이용하시려는 사용자를 위한 설정기능 추가

= 1.3.6 =
* "나의계정" 페이지로부터 "대기중"상태의 주문을 다시 지불하려고 할 때 결제창이 안뜨는 문제 해결 ( order_review페이지에서 결제 가능하도록 수정 )

= 1.3.5 =
* 휴대폰 소액결제에서 실물/디지털 상품 구분필드 적용(휴대폰 소액결제의 경우 실물 상품인지 디지털 상품인지 구분해서 결제창 요청해야합니다. 상품에 따라 결제수수료가 달라지는 부분이라 통신사가 심사 단계에서 필수로 요구하는 사항입니다)

= 1.3.4 =
* 가상계좌 입금대기중(awaiting-vbank) 상태에서 처리중(processing) 또는 완료됨(completed) 상태로 변경될 때 관리자/구매자에게 이메일 발송(입금완료되었음을 알리는 메일)
* 우커머스 이메일 설정에 가상계좌 입금완료 시 관리자/구매자에게 발송되는 설정 추가

= 1.3.3 =
* php short_open_tag 설정이 off인 경우에 가상계좌 정보 출력 로직이 제대로 안되는 버그 수정
* 결제 상세 정보가 중복으로 출력되는 버그 수정

= 1.3.2 =
* icon, banner추가
* 다른 플러그인의 iamport.php와 중복 로딩되는 것 방지

= 1.3.1 =
* 카카오페이 결제구분을 pay_method로 하지 않고 pg_provider로 하도록 변경. 카카오페이로 결제했더라도 pay_method는 card를 유지

= 1.3.0 =
* 카카오페이 결제수단 추가
* iamport.woocommerce.js 에서 가격에 소수점이 있는 경우 결제 오류나는 경우를 대비해 parseInt처리하여 방어적으로 변경(우커머스 소수점 자리수 설정 방지)
* iamport.woocommerce.js 에서 try catch문 후처리 과정에서 exception message출력하도록 수정(기존에 undefined변수를 출력하고 있었음)
* iamport.payment-1.1.0.js 로 아임포트 javascript API라이브러리 버전업

= 1.2.2 =
* ajax place order를 위해 추가된 iamport.woocommerce.js에서 사용하던 wc_checkout_form객체는 2.2.x버전에서는 지원되지 않는 객체여서 2.2.x호환되는 방식으로 변환

= 1.2.1 =
* 가상계좌 정보출력 소스코드(iamport-vbank.php)에서 syntax 에러가 발견되어 수정
* stable version 4.4로 상향

= 1.2 =
* 주문서 작성 후 "주문 확정" 단계에서 결제수단별(신용카드/실시간계좌이체/가상계좌/휴대폰소액결제) 분리
* 가상계좌 선택 시 결제 완료 페이지에서 입금계좌번호 출력 안되는 버그 수정
* 결제 내역 페이지에서도 결제정보 출력

= 1.1 =
* LGU+추가 지원
* "가상계좌 입금대기 중" 주문 상태 추가 정의
* 가상계좌 입금완료 처리로직 누락된 부분 추가
* 결제완료 후 결제 상세 정보 및 매출전표 확인 링크 출력
* 가상계좌 결제 시 구매자가 계좌정보를 확인할 수 있도록 주문접수 페이지에서 가상계좌 입금정보 노출

= 1.0 =
* 결제수단 선택 UI개선
* 에스크로결제 제공

= 0.9 =
* 최초 배포
* http://demo.movingcart.kr 에 적용된 버전


== Action Hook ==

= 아임포트 for 우커머스 플러그인이 제공하는 action hook =
*   `iamport_order_status_changed` : 아임포트에 의해 우커머스 주문 상태가 변경되었을 때 호출($old\_status, $new\_status, $order) 3개의 파라메터 제공
*   `iamport_order_meta_saved` : 아임포트와의 통신 후 주문에 대한 부가 정보를 저장할 때 호출($order\_id, $meta\_key, $meta\_value) 3개의 파라메터 제공 (meta\_key목록 아래 참조)
    *   \_iamport\_provider : 결제된 PG사코드
    *   \_iamport\_paymethod : 결제수단
    *   \_iamport\_pg\_tid : 결제건에 대한 PG사 승인번호
    *   \_iamport\_receipt\_url : 결제건에 대한 매출전표 URL
    *   \_iamport\_vbank_name : (가상계좌 결제 시)발급된 가상계좌 은행명
    *   \_iamport\_vbank_num : (가상계좌 결제 시)발급된 가상계좌 번호
    *   \_iamport\_vbank_date : (가상계좌 결제 시)발급된 가상계좌의 입금기한(unix timestamp)
*   `iamport_simple_order_name` : 일반 상품 주문시 적용되는 상품명 filter($order\_name, $order) 2개의 파라메터 제공
*   `iamport_recurring_order_name` : 정기결제 상품 주문시 적용되는 상품명 filter($order\_name, $order, $isInitial) 3개의 파라메터 제공

